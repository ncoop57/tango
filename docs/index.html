---

title: Tango ðŸ•ºðŸ’ƒ


keywords: fastai
sidebar: home_sidebar

summary: "Tango is a research tool for automatically detecting duplicate video-based bug reports by combining visual and textual information present in the videos."
description: "Tango is a research tool for automatically detecting duplicate video-based bug reports by combining visual and textual information present in the videos."
nb_path: "nbs/index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://doi.org/10.5281/zenodo.4453765"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.4453765.svg" alt="DOI"></a>
<a href="https://pypi.org/project/two-to-tango/"><img src="https://img.shields.io/pypi/pyversions/two-to-tango" alt="PyPI - Python Version"></a>
<a href="https://badge.fury.io/py/two-to-tango"><img src="https://badge.fury.io/py/two-to-tango.svg" alt="PyPI Status"></a>
<a href="https://pepy.tech/project/two-to-tango"><img src="https://pepy.tech/badge/two-to-tango" alt="PyPI Status"></a>
<a href="https://github.com/ncoop57/tango/blob/main/LICENSE"><img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="license"></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We provide all of our data, models, and results. You can download the zip here: <a href="https://doi.org/10.5281/zenodo.4439661">https://doi.org/10.5281/zenodo.4439661</a></p>
<p>In this data package, you will find two folders: <code>artifacts</code> and <code>outputs</code></p>
<p><code>artifacts</code> contains the videos we collected in our user study, the model files for the different models we evaluated, and the detailed results that we generated (See <code>Detailed Results</code> section for more information). The <code>videos</code> folder is broken down by user, where each user has a folder contain the apps they were given to create videos for. Each of the apps contain folders that denote the bug they generated a report for. Finally, instead these bug folders there is the actual video-based bug report as an mp4 file. The <code>user_assignment.csv</code> just contains the finalized assignments of users to corresponding bug reports.</p>
<p>In the <code>models</code> folder, you will find the two models we evaluated (SIFT, SimCLR, and OCR+IR). In each folder you will find the corresponding trained codebook files that we generated for SIFT and SimCLR. These codebook files are pickle files that contain the binary representation of the trained codebooks. Additionally, in the SimCLR folder, you will find a checkpoint and pytorch model file that contains all the necessary information for reloading our trained SimCLR model. For the <code>OCR+IR</code> folder, you will find all of the code for the OCR+IR model as well as the intermediate output for this particular model, other models' outputs are stored in the <code>outputs</code> folder.</p>
<p>The <code>outputs</code> folder contains all of the intermediate outputs of our code, except for OCR+IR. In the <code>results</code> folder, you will find all of the raw rankings and metrics for the SIFT and SimCLR model for all combinations of video-based bug reports per app. <strong>NOTE: SIFT is missing the 10k raw ranking and metrics, but will be provided in a future version.</strong> <code>evaluation_setting</code> contains a json file that contains all of the duplicate detection tasks we used for evaluating our models, i.e. <code>setting 2</code> (See paper for more details). <code>user_rankings_weighted_all</code> and <code>user_results_weighted_all</code> contain converted version of the raw rankings and metrics for the SIFT and SimCLR model to match <code>setting 2</code>. <code>extracted_text</code> contains the output of running the OCR model, i.e. the frames of the videos and the text from each frame. Lastly, <code>combined</code> contains the results of the combined tango approach.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reproduce-Results">Reproduce Results<a class="anchor-link" href="#Reproduce-Results"> </a></h2><blockquote><p>All code has only been tested on Ubuntu 20.04. Additionally, there is an issue when attempting to reproduce tango via Docker on MacOS. If you are using MacOS, please look at our steps for how to reproduce without Docker.</p>
</blockquote>
<p>The prefered method to reproduce our paper's results is to use Docker. Please install <a href="https://docs.docker.com/get-docker/">Docker</a> if you do not already have it install.</p>
<div class="highlight"><pre><span></span>git clone https://github.com/ncoop57/tango.git
<span class="nb">cd</span> tango
</pre></div>
<p><strong>Reproduce via Docker:</strong></p>
<div class="highlight"><pre><span></span>docker run -v &lt;out_path&gt;:/data semerulab/tools:tango &lt;vis_model&gt;
</pre></div>
<ul>
<li><strong>out_path</strong>: The absolute path on your machine you want all files to be saved to</li>
<li><strong>vis_model</strong>: The type of visual model. Can be either SimCLR or SIFT, taking ~6 hours or &gt;2 weeks, respectively, for all apps on our machine with 755G of RAM and 72 CPUs.</li>
</ul>
<p>You can also build the docker image yourself:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> docker_build
docker build -f Dockerfile.prod -t tango .
<span class="nb">cd</span> ..
docker run -v &lt;out_path&gt;:/data tango &lt;vis_model&gt;
</pre></div>
<p><strong>Reproduce without Docker:</strong></p>
<div class="highlight"><pre><span></span>pip install two-to-tango
tango_reproduce &lt;down_path&gt; &lt;out_path&gt; &lt;vis_model&gt;
</pre></div>
<ul>
<li><strong>down_path</strong>: The directory where all the files will be downloaded and extracted to.</li>
<li><strong>out_path</strong>: The output path to place all results in.</li>
<li><strong>vis_model</strong>: The type of visual model. Can be either SimCLR or SIFT, taking ~6 hours or &gt;2 weeks, respectively, for all apps on our machine with 755G of RAM and 72 CPUs.</li>
</ul>
<p>You can also use this <a href="https://colab.research.google.com/drive/128l3qK_cogDM38ApHM1lzwrCklo5bdhs?usp=sharing">Google Colab notebook</a>, however, due to the timeout associated with Google Colab, you will most likely be unable to generate all of our results in the alotted time.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Detailed-Results">Detailed Results<a class="anchor-link" href="#Detailed-Results"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can find a spreadsheet containing the results for all of the different configurations we tested at <code>tango_reproduction_package/artifacts/detailed_results.xlsx</code>.</p>
<p>In this excel file, we have multiple sheets. <code>overall</code> shows the performance of the different model configurations averaged across all apps. <code>overall_comb</code> shows the combined performance of the visual and textual model configurations averaged across all apps. Additionally, <code>per-app</code> and <code>per-app-comb</code> has the performance of the single and combined model configurations per app, respectively. Lastly, we provide the overall performance in sheet <code>overall_user_study</code> and <code>overall_user_study_comb</code> of the single and combined model configurations on the settings (used only APOD app) given to the users for evaluating how much time and effort tango can save developers.</p>
<p>All sheets show the performance in terms of mRR (<code>avg_rr</code>), the standard deviation of recipical rank, median (<code>med_rr</code>), and quartile 1 and 3 (<code>q#_rr</code>). The same is true for mAP (<code>avg_ap</code>). We also show the performance in terms of average rank including standard deviation, and quartiles. Lastly, we providing HIT@1-5, 7, and 10 (<code>h#</code>).</p>
<p>Sheets that contain the <code>weight</code> column have information regarding how much weight is given to the visual and textual information. A value of <code>0.1</code> means that the textual information received a weight of <code>0.1</code> while the visual information was given a weight of <code>0.9</code>. For values containing two numbers, e.g. <code>0.1-0.0</code>, refers to the weighting scheme introduced in the paper for when there may be high overlap in vocabulary between duplicate and non-duplicates (See paper for more details). If an app does not have high overlap, then a weight of <code>0.1</code> is used for the textual information, else the textual information is not considered, i.e., weight of <code>0.0</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>From pypi:</strong></p>
<p><code>pip install two-to-tango</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>From source:</strong></p>
<div class="highlight"><pre><span></span>git clone https://github.com/ncoop57/tango.git
<span class="nb">cd</span> tango
pip install .
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Download Data CLI Tool</strong></p>
<p><code>tango_download &lt;out_path&gt;</code></p>
<ul>
<li><strong>out_path</strong>: The output path to save and unzip all files.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Duplicate Detection CLI Tool</strong></p>
<p><code>tango &lt;query_path&gt; &lt;corpus_path&gt; &lt;simclr_path&gt;</code></p>
<ul>
<li><strong>query_path</strong>: The path to a video you want to detect duplicates for.<ul>
<li>Example: <code>&lt;out_path&gt;/tango_reproduction_package/artifacts/cli_videos/U1/APOD/CC1/APOD-CC1_fixed_30.mp4</code></li>
</ul>
</li>
<li><strong>corpus_path</strong>: The path to a video you want to detect duplicates for.<ul>
<li>Example: <code>&lt;out_path&gt;/tango_reproduction_package/artifacts/cli_videos</code></li>
</ul>
</li>
<li><strong>simclr_path</strong>: The path to a video you want to detect duplicates for.<ul>
<li>Example: <code>&lt;out_path&gt;/tango_reproduction_package/artifacts/models/SimCLR</code></li>
</ul>
</li>
</ul>
<p>Example Output:</p>
<div class="highlight"><pre><span></span><span class="n">OrderedDict</span><span class="p">([</span>   <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC1&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="mf">0.9838350837260246</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC1&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.9193482983504456</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC1&#39;</span><span class="p">,</span> <span class="s1">&#39;U2&#39;</span><span class="p">),</span> <span class="mf">0.3723964243572911</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC6&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.3718521026630344</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC9&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.36803837161265085</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC6&#39;</span><span class="p">,</span> <span class="s1">&#39;U8&#39;</span><span class="p">),</span> <span class="mf">0.33589710905277315</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC4&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.3118613303188616</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC9&#39;</span><span class="p">,</span> <span class="s1">&#39;U5&#39;</span><span class="p">),</span> <span class="mf">0.2718403622668689</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC4&#39;</span><span class="p">,</span> <span class="s1">&#39;U7&#39;</span><span class="p">),</span> <span class="mf">0.25082093055745974</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC9&#39;</span><span class="p">,</span> <span class="s1">&#39;U9&#39;</span><span class="p">),</span> <span class="mf">0.22580393621884165</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC5&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.1768510685792533</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC6&#39;</span><span class="p">,</span> <span class="s1">&#39;U7&#39;</span><span class="p">),</span> <span class="mf">0.1682816804179776</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC4&#39;</span><span class="p">,</span> <span class="s1">&#39;U8&#39;</span><span class="p">),</span> <span class="mf">0.13915926428362999</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">,</span> <span class="s1">&#39;U2&#39;</span><span class="p">),</span> <span class="mf">0.1354447367818957</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">,</span> <span class="s1">&#39;U2&#39;</span><span class="p">),</span> <span class="mf">0.12004454785432789</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC5&#39;</span><span class="p">,</span> <span class="s1">&#39;U7&#39;</span><span class="p">),</span> <span class="mf">0.11235793525631509</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC5&#39;</span><span class="p">,</span> <span class="s1">&#39;U8&#39;</span><span class="p">),</span> <span class="mf">0.10867946897348428</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC7&#39;</span><span class="p">,</span> <span class="s1">&#39;U8&#39;</span><span class="p">),</span> <span class="mf">0.09014217805772731</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;RB&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="mf">0.08324154319710894</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC8&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.08179046960502091</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC8&#39;</span><span class="p">,</span> <span class="s1">&#39;U5&#39;</span><span class="p">),</span> <span class="mf">0.07290831091450554</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;RB&#39;</span><span class="p">,</span> <span class="s1">&#39;U5&#39;</span><span class="p">),</span> <span class="mf">0.07194441953180176</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.06729098674201965</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC7&#39;</span><span class="p">,</span> <span class="s1">&#39;U7&#39;</span><span class="p">),</span> <span class="mf">0.06326635817907807</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC7&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.05922061313241868</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC8&#39;</span><span class="p">,</span> <span class="s1">&#39;U10&#39;</span><span class="p">),</span> <span class="mf">0.05328420969145727</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.04707548776015297</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="mf">0.04342630487280919</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">,</span> <span class="s1">&#39;U1&#39;</span><span class="p">),</span> <span class="mf">0.04211602057931267</span><span class="p">),</span>
                <span class="p">((</span><span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;RB&#39;</span><span class="p">,</span> <span class="s1">&#39;U12&#39;</span><span class="p">),</span> <span class="mf">0.029766244020504186</span><span class="p">)])</span>
</pre></div>
<p>If you would like to do this on your own data, look at the <code>tango_reproduction_package/artifacts/cli_videos</code> directory structure from our dataset on <a href="https://doi.org/10.5281/zenodo.4453765">Zenodo</a> for how you need to formate your data to work with <a href="/tango/cli.html#tango"><code>tango</code></a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-SimCLR">Training SimCLR<a class="anchor-link" href="#Training-SimCLR"> </a></h2><p>For training the SimCLR model we used the <a href="https://interactionmining.org/rico">RICO dataset</a> and <a href="https://github.com/dthiagarajan/simclr_pytorch">this</a> repository for training a SimCLR model using Pytorch Lightning</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To cite our work, please use the following bibtex:</p>

<pre><code>@inproceedings{Cooper:ICSE21,
      title={It Takes Two to Tango: Combining Visual and Textual Information for Detecting Duplicate Video-Based Bug Reports}, 
      author={Nathan Cooper and Carlos Bernal-CÃ¡rdenas and Oscar Chaparro and Kevin Moran and Denys Poshyvanyk},
      year={2021},
      booktitle={ICSEâ€™21},
}</code></pre>

</div>
</div>
</div>
</div>
 

