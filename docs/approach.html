---

title: Approach


keywords: fastai
sidebar: home_sidebar

summary: "This module contains all the code for defining the various approaches"
description: "This module contains all the code for defining the various approaches"
nb_path: "nbs/04_approach.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/04_approach.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flatten_dict" class="doc_header"><code>flatten_dict</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flatten_dict</code>(<strong><code>d_in</code></strong>, <strong><code>d_out</code></strong>, <strong><code>parent_key</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gen_extracted_features" class="doc_header"><code>gen_extracted_features</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gen_extracted_features</code>(<strong><code>vid_ds</code></strong>, <strong><code>mdl</code></strong>, <strong><code>fps</code></strong>, <strong><code>ftk</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gen_tfidfs" class="doc_header"><code>gen_tfidfs</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gen_tfidfs</code>(<strong><code>vid_ds_features</code></strong>, <strong><code>vw</code></strong>, <strong><code>codebook</code></strong>, <strong><code>df</code></strong>, <strong><code>ftk</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gen_bovw_similarity" class="doc_header"><code>gen_bovw_similarity</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gen_bovw_similarity</code>(<strong><code>vid_ds</code></strong>, <strong><code>vid_ds_features</code></strong>, <strong><code>mdl</code></strong>, <strong><code>codebook</code></strong>, <strong><code>vw</code></strong>, <strong><code>ftk</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fuzzy_LCS" class="doc_header"><code>fuzzy_LCS</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fuzzy_LCS</code>(<strong><code>X</code></strong>, <strong><code>Y</code></strong>, <strong><code>m</code></strong>, <strong><code>n</code></strong>, <strong><code>sim_func</code></strong>, <strong><code>codebook</code></strong>, <strong><code>df</code></strong>, <strong><code>vw</code></strong>, <strong><code>mdl_frame_threshold</code></strong>=<em><code>0.0</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some examples showing the differences between f-LCS and w-LCS</p>
<p>This example shows an example where there is a lot of overlap causes f-LCS similarity to be high, but since the overlap is not toward the end, the w-LCS similarity is lower.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">test_sim_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">lcs</span><span class="p">,</span> <span class="n">weighted_lcs</span> <span class="o">=</span> <span class="n">fuzzy_LCS</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">test_sim_func</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">lcs</span><span class="p">,</span> <span class="n">weighted_lcs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This example shows that if the overlap is towards the end of the two sequences, w-LCS will have a higher similarity than f-LCS</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">lcs</span><span class="p">,</span> <span class="n">weighted_lcs</span> <span class="o">=</span> <span class="n">fuzzy_LCS</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">test_sim_func</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">lcs</span><span class="p">,</span> <span class="n">weighted_lcs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="gen_lcs_similarity" class="doc_header"><code>gen_lcs_similarity</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L136" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>gen_lcs_similarity</code>(<strong><code>vid_ds</code></strong>, <strong><code>vid_ds_features</code></strong>, <strong><code>sim_func</code></strong>, <strong><code>mdl</code></strong>, <strong><code>codebook</code></strong>, <strong><code>df</code></strong>, <strong><code>vw</code></strong>, <strong><code>ftk</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fix_sims" class="doc_header"><code>fix_sims</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L171" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fix_sims</code>(<strong><code>vid_sims</code></strong>, <strong><code>vid_ds</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sort_rankings" class="doc_header"><code>sort_rankings</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L183" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sort_rankings</code>(<strong><code>vid_sims</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="approach" class="doc_header"><code>approach</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L203" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>approach</code>(<strong><code>vid_ds</code></strong>, <strong><code>vid_ds_features</code></strong>, <strong><code>bovw_vid_ds_sims</code></strong>, <strong><code>lcs_vid_ds_sims</code></strong>, <strong><code>mdl</code></strong>, <strong><code>sim_func</code></strong>, <strong><code>codebook</code></strong>, <strong><code>df</code></strong>, <strong><code>vw</code></strong>, <strong><code>fps</code></strong>=<em><code>30</code></em>, <strong><code>ftk</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/data/datasets/validation_set&quot;</span><span class="p">)</span>
<span class="n">vid_ds</span> <span class="o">=</span> <span class="n">VideoDataset</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">label_from_paths</span><span class="p">()</span>
<span class="n">vid_ds</span><span class="o">.</span><span class="n">get_labels</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fps</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">ftk</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">vw</span> <span class="o">=</span> <span class="mi">1_000</span>
<span class="n">model_01</span> <span class="o">=</span> <span class="s1">&#39;M01&#39;</span>
<span class="n">simclr</span> <span class="o">=</span> <span class="n">SimCLRModel</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;/tf/data/models/simclr/checkpointepoch=98.ckpt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">M01</span> <span class="o">=</span> <span class="n">SimCLRExtractor</span><span class="p">(</span><span class="n">simclr</span><span class="p">)</span>

<span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/tf/data/models/codebooks/M01/cookbook_M01_</span><span class="si">{</span><span class="n">vw</span><span class="si">}</span><span class="s1">vw.model&#39;</span>
<span class="n">codebook_01</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vid_ds_features</span> <span class="o">=</span> <span class="n">gen_extracted_features</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">M01</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">bovw_vid_ds_sims</span> <span class="o">=</span> <span class="n">gen_bovw_similarity</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">M01</span><span class="p">,</span> <span class="n">codebook_01</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
<span class="n">lcs_vid_ds_sims</span> <span class="o">=</span> <span class="n">gen_lcs_similarity</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">simclr_frame_sim</span><span class="p">,</span> <span class="n">M01</span><span class="p">,</span> <span class="n">codebook_01</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># df, vid_ds_sims = gen_similarity(vid_ds, vid_ds_features, M01, codebook_01, vw, ftk)</span>
<span class="n">rankings_01</span> <span class="o">=</span> <span class="n">approach</span><span class="p">(</span>
    <span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">bovw_vid_ds_sims</span><span class="p">,</span> <span class="n">lcs_vid_ds_sims</span><span class="p">,</span> <span class="n">M01</span><span class="p">,</span> <span class="n">simclr_frame_sim</span><span class="p">,</span>
    <span class="n">codebook_01</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span><span class="p">,</span> <span class="n">ftk</span> <span class="o">=</span> <span class="n">ftk</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rankings_01</span><span class="p">[</span><span class="s1">&#39;weighted_lcs&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">evals</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">rankings_01</span><span class="p">[</span><span class="s1">&#39;lcs&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_sims" class="doc_header"><code>compute_sims</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/approach.py#L252" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_sims</code>(<strong><code>q_vid</code></strong>, <strong><code>vid_ds</code></strong>, <strong><code>model</code></strong>, <strong><code>codebook</code></strong>, <strong><code>vw</code></strong>, <strong><code>fps</code></strong>, <strong><code>ftk</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

