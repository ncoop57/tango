---

title: Eval

keywords: fastai
sidebar: home_sidebar

summary: "This module contains all the necessary functions for evaluating different video duplication detection techniques."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_eval.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_tf_idf" class="doc_header"><code>calc_tf_idf</code><a href="https://github.com/ncoop57/tango/tree/master/tango/features.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_tf_idf</code>(<strong><code>tfs</code></strong>, <strong><code>dfs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cosine_similarity" class="doc_header"><code>cosine_similarity</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cosine_similarity</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Following-methods-from:-https://gist.github.com/bwhite/3726239">Following methods from: <a href="https://gist.github.com/bwhite/3726239">https://gist.github.com/bwhite/3726239</a><a class="anchor-link" href="#Following-methods-from:-https://gist.github.com/bwhite/3726239">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mean_reciprocal_rank" class="doc_header"><code>mean_reciprocal_rank</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mean_reciprocal_rank</code>(<strong><code>rs</code></strong>)</p>
</blockquote>
<p>Score is reciprocal of the rank of the first relevant item</p>
<p>First element is 'rank 1'.  Relevance is binary (nonzero is relevant).</p>
<p>Example from <a href="http://en.wikipedia.org/wiki/Mean_reciprocal_rank">http://en.wikipedia.org/wiki/Mean_reciprocal_rank</a></p>
<blockquote><blockquote><blockquote><p>rs = [[0, 0, 1], [0, 1, 0], [1, 0, 0]]
mean_reciprocal_rank(rs)
0.61111111111111105
rs = np.array([[0, 0, 0], [0, 1, 0], [1, 0, 0]])
mean_reciprocal_rank(rs)
0.5
rs = [[0, 0, 0, 1], [1, 0, 0], [1, 0, 0]]
mean_reciprocal_rank(rs)
0.75</p>
</blockquote>
</blockquote>
</blockquote>
<p>Args:
    rs: Iterator of relevance scores (list or numpy) in rank order
        (first element is the first item)</p>
<p>Returns:
    Mean reciprocal rank</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="r_precision" class="doc_header"><code>r_precision</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>r_precision</code>(<strong><code>r</code></strong>)</p>
</blockquote>
<p>Score is precision after all relevant documents have been retrieved</p>
<p>Relevance is binary (nonzero is relevant).</p>
<blockquote><blockquote><blockquote><p>r = [0, 0, 1]
r_precision(r)
0.33333333333333331
r = [0, 1, 0]
r_precision(r)
0.5
r = [1, 0, 0]
r_precision(r)
1.0</p>
</blockquote>
</blockquote>
</blockquote>
<p>Args:
    r: Relevance scores (list or numpy) in rank order
        (first element is the first item)</p>
<p>Returns:
    R Precision</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="precision_at_k" class="doc_header"><code>precision_at_k</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>precision_at_k</code>(<strong><code>r</code></strong>, <strong><code>k</code></strong>)</p>
</blockquote>
<p>Score is precision @ k</p>
<p>Relevance is binary (nonzero is relevant).</p>
<blockquote><blockquote><blockquote><p>r = [0, 0, 1]
precision_at_k(r, 1)
0.0
precision_at_k(r, 2)
0.0
precision_at_k(r, 3)
0.33333333333333331
precision_at_k(r, 4)
Traceback (most recent call last):
    File "<stdin>", line 1, in ?
ValueError: Relevance score length &lt; k</p>
</blockquote>
</blockquote>
</blockquote>
<p>Args:
    r: Relevance scores (list or numpy) in rank order
        (first element is the first item)</p>
<p>Returns:
    Precision @ k</p>
<p>Raises:
    ValueError: len(r) must be &gt;= k</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="average_precision" class="doc_header"><code>average_precision</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L132" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>average_precision</code>(<strong><code>r</code></strong>)</p>
</blockquote>
<p>Score is average precision (area under PR curve)</p>
<p>Relevance is binary (nonzero is relevant).</p>
<blockquote><blockquote><blockquote><p>r = [1, 1, 0, 1, 0, 1, 0, 0, 0, 1]
delta_r = 1. / sum(r)
sum([sum(r[:x + 1]) / (x + 1.) * delta_r for x, y in enumerate(r) if y])
0.7833333333333333
average_precision(r)
0.78333333333333333</p>
</blockquote>
</blockquote>
</blockquote>
<p>Args:
    r: Relevance scores (list or numpy) in rank order
        (first element is the first item)</p>
<p>Returns:
    Average precision</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mean_average_precision" class="doc_header"><code>mean_average_precision</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mean_average_precision</code>(<strong><code>rs</code></strong>)</p>
</blockquote>
<p>Score is mean average precision</p>
<p>Relevance is binary (nonzero is relevant).</p>
<blockquote><blockquote><blockquote><p>rs = [[1, 1, 0, 1, 0, 1, 0, 0, 0, 1]]
mean_average_precision(rs)
0.78333333333333333
rs = [[1, 1, 0, 1, 0, 1, 0, 0, 0, 1], [0]]
mean_average_precision(rs)
0.39166666666666666</p>
</blockquote>
</blockquote>
</blockquote>
<p>Args:
    rs: Iterator of relevance scores (list or numpy) in rank order
        (first element is the first item)</p>
<p>Returns:
    Mean average precision</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">mean_reciprocal_rank</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">average_precision</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7833333333333333</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean_average_precision</span><span class="p">(</span><span class="n">rs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.5</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate" class="doc_header"><code>evaluate</code><a href="https://github.com/ncoop57/tango/tree/master/tango/eval.py#L180" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate</code>(<strong><code>results</code></strong>, <strong><code>top_n</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="k">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_prep.ipynb.
Converted 01_features.ipynb.
Converted 02_eval.ipynb.
Converted 03_cnn.ipynb.
This cell doesn&#39;t have an export destination and was ignored:
 
Converted 04_experiments.ipynb.
Converted SimCLR.ipynb.
Converted index.ipynb.
Converted lesson1-pets.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

