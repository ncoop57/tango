---

title: CLI


keywords: fastai
sidebar: home_sidebar

summary: "This module contains all the code for defining Tango's CLI"
description: "This module contains all the code for defining Tango's CLI"
nb_path: "nbs/05_cli.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/05_cli.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download" class="doc_header"><code>download</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/cli.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download</code>(<strong><code>out_path</code></strong>:"The output path to save and unzip all files.")</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;/tf/main/data&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># N_IMGS = 15_000</span>
<span class="c1"># N_FRAMES_TO_KEEP = [1]</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">out_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/data/output&quot;</span><span class="p">)</span>
<span class="n">art_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/data/tango_reproduction_package/artifacts&quot;</span><span class="p">)</span>
<span class="n">vis_model</span> <span class="o">=</span> <span class="s2">&quot;SimCLR&quot;</span>

<span class="c1"># vid_ds = VideoDataset.from_path(</span>
<span class="c1">#     art_path/&quot;videos&quot;, fr = FPS</span>
<span class="c1"># ).label_from_paths()</span>

<span class="c1"># _generate_vis_results(vid_ds, out_path, art_path, vis_model)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">N_FRAMES_TO_KEEP</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">_generate_txt_results</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">art_path</span><span class="p">,</span> <span class="n">vis_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>INFO:root:Computing rankings and calculating metrics for textual model.
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;1ftk&#39;, &#39;technique&#39;: &#39;weighted_lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;1ftk&#39;, &#39;technique&#39;: &#39;bovw&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;1ftk&#39;, &#39;technique&#39;: &#39;lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;1ftk&#39;, &#39;technique&#39;: &#39;bovw_lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;1ftk&#39;, &#39;technique&#39;: &#39;bovw_weighted_lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;5ftk&#39;, &#39;technique&#39;: &#39;weighted_lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;5ftk&#39;, &#39;technique&#39;: &#39;bovw&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;5ftk&#39;, &#39;technique&#39;: &#39;lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;5ftk&#39;, &#39;technique&#39;: &#39;bovw_lcs&#39;}
Running setting setting2
dict_keys([&#39;lcs&#39;, &#39;weighted_lcs&#39;, &#39;bovw&#39;, &#39;bovw_lcs&#39;, &#39;bovw_weighted_lcs&#39;])
Running config:  {&#39;model&#39;: &#39;SimCLR&#39;, &#39;vwords&#39;: &#39;1000vw&#39;, &#39;fps&#39;: &#39;30fps&#39;, &#39;ftk&#39;: &#39;5ftk&#39;, &#39;technique&#39;: &#39;bovw_weighted_lcs&#39;}
Running setting setting2
Writing results and rankings
done
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">out_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/data/output&quot;</span><span class="p">)</span>

<span class="n">combo_out_path</span> <span class="o">=</span> <span class="n">out_path</span><span class="o">/</span><span class="s2">&quot;combined&quot;</span>
<span class="n">dl_ranking_path</span> <span class="o">=</span> <span class="n">out_path</span><span class="o">/</span><span class="s2">&quot;user_rankings_weighted_all&quot;</span><span class="o">/</span><span class="s2">&quot;all_rankings.csv&quot;</span>
<span class="n">txt_path</span> <span class="o">=</span> <span class="n">art_path</span><span class="o">/</span><span class="s2">&quot;models&quot;</span><span class="o">/</span><span class="s2">&quot;OCR+IR&quot;</span>
<span class="n">ir_rankings_path</span> <span class="o">=</span> <span class="n">txt_path</span><span class="o">/</span><span class="s2">&quot;tango_txt_rankings&quot;</span><span class="o">/</span><span class="s2">&quot;all_rankings.json&quot;</span>
<span class="n">settings_path</span> <span class="o">=</span> <span class="n">out_path</span><span class="o">/</span><span class="s2">&quot;evaluation_settings&quot;</span>

<span class="n">tango_combined</span><span class="p">(</span><span class="n">combo_out_path</span><span class="p">,</span> <span class="n">dl_ranking_path</span><span class="p">,</span> <span class="n">ir_rankings_path</span><span class="p">,</span> <span class="n">settings_path</span><span class="p">,</span> <span class="n">BEST_DL_MODELS</span><span class="p">,</span> <span class="n">BEST_IR_MODELS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-53e994fd6274&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> settings_path <span class="ansi-blue-fg">=</span> out_path<span class="ansi-blue-fg">/</span><span class="ansi-blue-fg">&#34;evaluation_settings&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-fg">----&gt; 9</span><span class="ansi-red-fg"> </span>tango_combined<span class="ansi-blue-fg">(</span>combo_out_path<span class="ansi-blue-fg">,</span> dl_ranking_path<span class="ansi-blue-fg">,</span> ir_rankings_path<span class="ansi-blue-fg">,</span> settings_path<span class="ansi-blue-fg">,</span> BEST_DL_MODELS<span class="ansi-blue-fg">,</span> BEST_IR_MODELS<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~tf/main/two_to_tango/combo.py</span> in <span class="ansi-cyan-fg">tango_combined</span><span class="ansi-blue-fg">(out_path, dl_rankings_path, ir_rankings_path, settings_path, dl_models, ir_models)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span>                                                                     rec[&#39;technique&#39;],))
<span class="ansi-green-intense-fg ansi-bold">    209</span> 
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">     </span>ir_rankings <span class="ansi-blue-fg">=</span> read_json<span class="ansi-blue-fg">(</span>ir_rankings_path<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span>     ir_rankings_by_config = group_dict(ir_rankings, lambda rec: (rec[&#39;model&#39;], rec[&#39;fps&#39;],
<span class="ansi-green-intense-fg ansi-bold">    212</span>                                                                     rec[&#39;technique&#39;],))

<span class="ansi-green-fg">~tf/main/two_to_tango/utils.py</span> in <span class="ansi-cyan-fg">read_json</span><span class="ansi-blue-fg">(file_path)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span> 
<span class="ansi-green-intense-fg ansi-bold">     38</span> <span class="ansi-green-fg">def</span> read_json<span class="ansi-blue-fg">(</span>file_path<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 39</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">with</span> open<span class="ansi-blue-fg">(</span>file_path<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> file<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     40</span>         <span class="ansi-green-fg">return</span> json<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>file<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span> 

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/tf/main/data/tango_reproduction_package/artifacts/models/OCR+IR/tango_txt_rankings/all_rankings.json&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vis_model</span> <span class="o">=</span> <span class="s2">&quot;SimCLR&quot;</span>
<span class="n">out_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/data/output&quot;</span><span class="p">)</span>
<span class="n">_output_performance</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">BEST_MODEL_CONFIGS</span><span class="p">[</span><span class="n">vis_model</span><span class="p">],</span> <span class="n">BEST_MODEL_CONFIGS</span><span class="p">[</span><span class="s2">&quot;OCR+IR&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>        Model: SimCLR-1000vw-5ftk-bovw,ocr+ir-5ftk-all_text,weight=0.2-0
        Overall mRR: 0.7521122972820503
        Overall mAP: 0.6843871569103048
        Overall Mean Rank: 1.9419753086419753
        
        Model: SimCLR-1000vw-5ftk-bovw
        Overall mRR: 0.708187709862351
        Overall mAP: 0.6392624653390201
        Overall Mean Rank: 2.105794790005316
        
        Model: ocr+ir-5ftk-all_text
        Overall mRR: 0.725243535246192
        Overall mAP: 0.6499718806108282
        Overall Mean Rank: 2.0563230605738574
        
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:18: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:27: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
/usr/local/lib/python3.6/dist-packages/ipykernel_launcher.py:35: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reproduce" class="doc_header"><code>reproduce</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/cli.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reproduce</code>(<strong><code>down_path</code></strong>:"The directory where all the files will be downloaded and extracted to.", <strong><code>out_path</code></strong>:"The output path to place all results in.", <strong><code>vis_model</code></strong>:"The type of visual model. Can be either SimCLR or SIFT, taking ~6 hours or &gt;2 weeks, respectively, for all apps on our machine with 755G of RAM and 72 CPUs.")</p>
</blockquote>
<p>Function for reproducing all results related to this tool's paper</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">VWORDS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1_000</span><span class="p">]</span>
<span class="n">N_IMGS</span> <span class="o">=</span> <span class="mi">15_000</span>
<span class="n">N_FRAMES_TO_KEEP</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">FPS</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">down_path</span> <span class="o">=</span> <span class="s2">&quot;/tf/main/data&quot;</span>
<span class="n">out_path</span> <span class="o">=</span> <span class="s2">&quot;/tf/main/data/tango_reproduction_package/outputs&quot;</span>
<span class="n">vis_model</span> <span class="o">=</span> <span class="s2">&quot;SimCLR&quot;</span>

<span class="n">reproduce</span><span class="p">(</span><span class="n">down_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">vis_model</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tango" class="doc_header"><code>tango</code><a href="https://github.com/ncoop57/tango/tree/main/two_to_tango/cli.py#L239" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tango</code>(<strong><code>q_path</code></strong>:"Path to the query video", <strong><code>cor_path</code></strong>:"Path to the corpus", <strong><code>simclr_path</code></strong>:"Path to the SimCLR model directory")</p>
</blockquote>
<p>Function for calculating similarity scores of a corpus of video-based bug
reports to a query video-based bug report. Currently only uses the top
performing SimCLR model from our paper
"It Takes Two to TANGO: Combining Visual andTextual Information for Detecting DuplicateVideo-Based Bug Reports".</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">corpus_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/tango_reproduction_package/artifacts/cli_videos&quot;</span><span class="p">)</span>
<span class="n">query_path</span> <span class="o">=</span> <span class="n">corpus_path</span><span class="o">/</span><span class="s2">&quot;U1&quot;</span><span class="o">/</span><span class="s2">&quot;APOD&quot;</span><span class="o">/</span><span class="s2">&quot;CC1&quot;</span><span class="o">/</span><span class="s2">&quot;APOD-CC1_fixed_30.mp4&quot;</span>
<span class="n">simclr_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/main/tango_reproduction_package/artifacts/models/SimCLR&quot;</span><span class="p">)</span>
<span class="n">tango</span><span class="p">(</span><span class="n">query_path</span><span class="p">,</span> <span class="n">corpus_path</span><span class="p">,</span> <span class="n">simclr_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_prep.ipynb.
Converted 01_features.ipynb.
Converted 02_eval.ipynb.
Converted 03_model.ipynb.
Converted 04_approach.ipynb.
Converted 05_cli.ipynb.
Converted 06_results.ipynb.
Converted 07_utils.ipynb.
Converted 08_combo.ipynb.
Converted index.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

