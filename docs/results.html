---

title: Results


keywords: fastai
sidebar: home_sidebar

summary: "This module contains all the code for running our experiments for Tango. To reproduce our results, please run each of the cells in this notebook."
description: "This module contains all the code for running our experiments for Tango. To reproduce our results, please run each of the cells in this notebook."
nb_path: "nbs/06_results.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_results.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/data&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Data-Setup">Data Setup<a class="anchor-link" href="#Data-Setup"> </a></h1><h3 id="Description:">Description:<a class="anchor-link" href="#Description:"> </a></h3><ul>
<li>Number of Participants: 14 (10 Ph.D. Students/Developers and 4 authors)</li>
<li>Number of Applications: 6</li>
<li>Number of Bug Reports per Application: 10</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fps</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds_user</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
<span class="n">vid_user_ds</span> <span class="o">=</span> <span class="n">VideoDataset</span><span class="o">.</span><span class="n">from_path</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s2">&quot;artifacts/videos&quot;</span><span class="p">,</span> <span class="n">fr</span> <span class="o">=</span> <span class="n">fps</span><span class="p">)</span><span class="o">.</span><span class="n">label_from_paths</span><span class="p">()</span>
<span class="n">vid_user_ds</span><span class="o">.</span><span class="n">get_labels</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-Visual-Based-Models">Run Visual-Based Models<a class="anchor-link" href="#Run-Visual-Based-Models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Model-Setup">Model Setup<a class="anchor-link" href="#Model-Setup"> </a></h1><h3 id="Configurations:">Configurations:<a class="anchor-link" href="#Configurations:"> </a></h3><ul>
<li>Number of Visual Words: 1,000, 5,000, 10,000</li>
<li>Codebook Number of Image Samples: MAX ~50,000</li>
<li>Number of frames kept: 1, 5</li>
<li>Model + Bag of Visual Words</li>
<li>Model + Fuzzy LCS</li>
<li>Model + LCS</li>
<li>Model + Bag of Visual Words + Fuzzy LCS</li>
<li>Model + Bag of Visual Words + Weight LCS</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="SIFT---M00">SIFT - M00<a class="anchor-link" href="#SIFT---M00"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_00</span> <span class="o">=</span> <span class="s1">&#39;SIFT&#39;</span>
<span class="n">M00</span> <span class="o">=</span> <span class="n">SIFTExtractor</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">xfeatures2d</span><span class="o">.</span><span class="n">SIFT_create</span><span class="p">(</span><span class="n">nfeatures</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span> <span class="c1"># limit SIFT features to top 10</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="SimCLR---M01">SimCLR - M01<a class="anchor-link" href="#SimCLR---M01"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_01</span> <span class="o">=</span> <span class="s1">&#39;SimCLR&#39;</span>
<span class="n">simclr</span> <span class="o">=</span> <span class="n">SimCLRModel</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;artifacts/models/SimCLR/checkpointepoch=98.ckpt&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">M01</span> <span class="o">=</span> <span class="n">SimCLRExtractor</span><span class="p">(</span><span class="n">simclr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Change these parameters if you want to only run a subset of our experiments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vwords</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1_000</span><span class="p">,</span> <span class="mi">5_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">]</span>
<span class="n">n_imgs</span> <span class="o">=</span> <span class="mi">15_000</span>
<span class="n">n_frames_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">generate_rankings</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">vid_ds</span><span class="p">,</span> <span class="n">ds_name</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sim_func</span><span class="p">,</span> <span class="n">vwords</span><span class="p">,</span> <span class="n">n_imgs</span><span class="p">,</span>
     <span class="n">n_frames_to_keep</span><span class="p">,</span> <span class="n">fps</span>
<span class="p">):</span>

    <span class="k">for</span> <span class="n">vw</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">vwords</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ftk</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">n_frames_to_keep</span><span class="p">):</span>
            <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;artifacts/models/</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">/cookbook_</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">vw</span><span class="si">}</span><span class="s1">vw.model&#39;</span>
            <span class="n">codebook</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">vid_ds_features</span> <span class="o">=</span> <span class="n">gen_extracted_features</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">feature_gen_time</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">bovw_vid_ds_sims</span> <span class="o">=</span> <span class="n">gen_bovw_similarity</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">codebook</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
            <span class="n">lcs_vid_ds_sims</span> <span class="o">=</span> <span class="n">gen_lcs_similarity</span><span class="p">(</span><span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">sim_func</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">codebook</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">ftk</span><span class="p">)</span>
            
            <span class="n">rankings</span> <span class="o">=</span> <span class="n">approach</span><span class="p">(</span>
                <span class="n">vid_ds</span><span class="p">,</span> <span class="n">vid_ds_features</span><span class="p">,</span> <span class="n">bovw_vid_ds_sims</span><span class="p">,</span> <span class="n">lcs_vid_ds_sims</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sim_func</span><span class="p">,</span>
                <span class="n">codebook</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">vw</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span><span class="p">,</span> <span class="n">ftk</span> <span class="o">=</span> <span class="n">ftk</span><span class="p">,</span>
            <span class="p">)</span>
            
            <span class="n">evaluation_metrics</span><span class="p">[</span><span class="s1">&#39;bovw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">rankings</span><span class="p">[</span><span class="s1">&#39;bovw&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">evaluation_metrics</span><span class="p">[</span><span class="s1">&#39;lcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">rankings</span><span class="p">[</span><span class="s1">&#39;lcs&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">evaluation_metrics</span><span class="p">[</span><span class="s1">&#39;weighted_lcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">rankings</span><span class="p">[</span><span class="s1">&#39;weighted_lcs&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="n">evaluation_metrics</span><span class="p">[</span><span class="s1">&#39;bovw_lcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">rankings</span><span class="p">[</span><span class="s1">&#39;bovw_lcs&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">evaluation_metrics</span><span class="p">[</span><span class="s1">&#39;bovw_weighted_lcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">rankings</span><span class="p">[</span><span class="s1">&#39;bovw_weighted_lcs&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="n">id_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ds_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">n_imgs</span><span class="si">}</span><span class="s1">n_</span><span class="si">{</span><span class="n">vw</span><span class="si">}</span><span class="s1">vw_</span><span class="si">{</span><span class="n">ftk</span><span class="si">}</span><span class="s1">ftk&#39;</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;outputs/results/</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">/rankings_</span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;outputs/results/</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">/evaluation_metrics_</span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s1">.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">evaluation_metrics</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="User-Data">User Data<a class="anchor-link" href="#User-Data"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The SIFT (M00) model takes a significant amount of time to run (&gt;24 hours) on our machine</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">generate_rankings</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">vid_user_ds</span><span class="p">,</span> <span class="n">ds_user</span><span class="p">,</span> <span class="n">model_00</span><span class="p">,</span> <span class="n">M00</span><span class="p">,</span> <span class="n">sift_frame_sim</span><span class="p">,</span> <span class="n">vwords</span><span class="p">,</span> <span class="n">n_imgs</span><span class="p">,</span>
    <span class="n">n_frames_to_keep</span><span class="p">,</span> <span class="n">fps</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>SimCLR (M01) model is a lot faster than SIFT (~6 hours) on our machines</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">generate_rankings</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">vid_user_ds</span><span class="p">,</span> <span class="n">ds_user</span><span class="p">,</span> <span class="n">model_01</span><span class="p">,</span> <span class="n">M01</span><span class="p">,</span> <span class="n">simclr_frame_sim</span><span class="p">,</span> <span class="n">vwords</span><span class="p">,</span> <span class="n">n_imgs</span><span class="p">,</span>
    <span class="n">n_frames_to_keep</span><span class="p">,</span> <span class="n">fps</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reviewing-Results">Reviewing Results<a class="anchor-link" href="#Reviewing-Results"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_eval_results</span><span class="p">(</span><span class="n">evals</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="n">app</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;elapsed_time&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;Bug Hit@1&#39;</span> \
        <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;Bug Hit@5&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;Bug Hit@10&#39;</span> \
        <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App std rank&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App mean rank&#39;</span> \
        <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App median rank&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App mRR&#39;</span> \
        <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App mAP&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App Hit@1&#39;</span> \
        <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App Hit@5&#39;</span> <span class="ow">or</span> <span class="n">bug</span> <span class="o">==</span> <span class="s1">&#39;App Hit@10&#39;</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">for</span> <span class="n">vid</span> <span class="ow">in</span> <span class="n">evals</span><span class="p">[</span><span class="n">app</span><span class="p">][</span><span class="n">bug</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">evals</span><span class="p">[</span><span class="n">app</span><span class="p">][</span><span class="n">bug</span><span class="p">][</span><span class="n">vid</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">continue</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">id_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ds_user</span><span class="si">}</span><span class="s1">_15000n_1000vw_5ftk&#39;</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="sa">f</span><span class="s1">&#39;outputs/results/</span><span class="si">{</span><span class="n">model_01</span><span class="si">}</span><span class="s1">/evaluation_metrics_</span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s1">.pkl&#39;</span>
<span class="n">evals</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_eval_results</span><span class="p">(</span><span class="n">evals</span><span class="p">[</span><span class="s1">&#39;weighted_lcs&#39;</span><span class="p">],</span> <span class="s1">&#39;APOD&#39;</span><span class="p">,</span> <span class="s1">&#39;rank&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-Textual-Based-Model">Run Textual-Based Model<a class="anchor-link" href="#Run-Textual-Based-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Generate the settings file</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">csv_file_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;artifacts/user_assignment.csv&#39;</span>
<span class="n">settings_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs/evaluation_settings&#39;</span>
<span class="n">video_data</span> <span class="o">=</span> <span class="n">read_video_data</span><span class="p">(</span><span class="n">csv_file_path</span><span class="p">)</span>
<span class="n">generate_setting2</span><span class="p">(</span><span class="n">video_data</span><span class="p">,</span> <span class="n">settings_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Convert results from model to format of the settings</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sim_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs/results&#39;</span>
<span class="n">out_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs&#39;</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SimCLR&#39;</span><span class="p">]</span>
<span class="n">convert_results_format</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span> <span class="n">settings_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Run OCR text extractor</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vid_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;artifacts/videos&#39;</span>
<span class="n">txt_out_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs/extracted_text&#39;</span>
<span class="n">get_all_texts</span><span class="p">(</span><span class="n">vid_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">get_all_texts</span><span class="p">(</span><span class="n">vid_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ol>
<li>Run text preprocessing, build document index, and run lucene</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">cd</span> {path}/artifacts/models/tango_txt/
<span class="o">!</span> sh build_run.sh <span class="o">{</span>txt_out_path<span class="o">}</span> <span class="o">{</span>settings_path<span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Outputs results to /tf/data/artifacts/tango_txt/tango_txt_results</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Combining-Textual-Information">Combining Textual Information<a class="anchor-link" href="#Combining-Textual-Information"> </a></h2><ol>
<li>Compute the combination of visual and textual information</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">combo_out_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs/combined&#39;</span>
<span class="n">dl_ranking_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;outputs/user_rankings_weighted_all/all_rankings.csv&#39;</span>
<span class="n">ir_rankings_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;artifacts/models/tango_txt/tango_txt_rankings/all_rankings.json&#39;</span>

<span class="n">best_dl_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;SimCLR-1000vw-5ftk-bovw&quot;</span><span class="p">,</span> <span class="s2">&quot;SimCLR-5000vw-5ftk-bovw_lcs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SimCLR-5000vw-5ftk-bovw_weighted_lcs&quot;</span><span class="p">,</span> <span class="s2">&quot;SimCLR-1000vw-5ftk-bovw_weighted_lcs&quot;</span>
<span class="p">]</span>
<span class="n">best_ir_models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ocr+ir--1ftk-all_text&quot;</span><span class="p">,</span> <span class="s2">&quot;ocr+ir--5ftk-all_text&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ocr+ir--5ftk-unique_frames&quot;</span><span class="p">,</span> <span class="s2">&quot;ocr+ir--5ftk-unique_words&quot;</span>
<span class="p">]</span>

<span class="n">tango_combined</span><span class="p">(</span><span class="n">combo_out_path</span><span class="p">,</span> <span class="n">dl_ranking_path</span><span class="p">,</span> <span class="n">ir_rankings_path</span><span class="p">,</span> <span class="n">settings_path</span><span class="p">,</span> <span class="n">best_dl_models</span><span class="p">,</span> <span class="n">best_ir_models</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

