---

title: Prep

keywords: fastai
sidebar: home_sidebar

summary: "This module contains all the necessary functions for loading and preprocessing videos into a standard format to be used in the rest of the pipeline."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/00_prep.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fix_frame_rate" class="doc_header"><code>fix_frame_rate</code><a href="https://github.com/ncoop57/tango/tree/master/tango/prep.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fix_frame_rate</code>(<strong><code>video_paths</code></strong>, <strong><code>fr</code></strong>=<em><code>30</code></em>)</p>
</blockquote>
<p>Fixes each video in the list of video paths to a certain frame rate</p>
<p>Returns a list of paths to the new fixed frame rate videos</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/tf/data/datasets/videos&quot;</span><span class="p">)</span>
<span class="n">video_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/video.mp4&quot;</span><span class="p">));</span> <span class="n">video_paths</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[PosixPath(&#39;/tf/data/datasets/videos/art_and_design/ibis_paint/scenario1/video.mp4&#39;),
 PosixPath(&#39;/tf/data/datasets/videos/art_and_design/ibis_paint/scenario2/video.mp4&#39;),
 PosixPath(&#39;/tf/data/datasets/videos/art_and_design/pixel_art_paint/scenario1/video.mp4&#39;),
 PosixPath(&#39;/tf/data/datasets/videos/art_and_design/pixel_art_paint/scenario2/video.mp4&#39;),
 PosixPath(&#39;/tf/data/datasets/videos/auto_and_vehicles/car_part/scenario1/video.mp4&#39;),
 PosixPath(&#39;/tf/data/datasets/videos/auto_and_vehicles/car_part/scenario2/video.mp4&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fr</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">fixed_paths</span> <span class="o">=</span> <span class="n">fix_frame_rate</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">fr</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">fixed_paths</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="n">fr</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ffmpeg</span><span class="o">.</span><span class="n">probe</span><span class="p">(</span><span class="n">fp</span><span class="p">)[</span><span class="s2">&quot;streams&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;avg_frame_rate&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chunk_videos" class="doc_header"><code>chunk_videos</code><a href="https://github.com/ncoop57/tango/tree/master/tango/prep.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chunk_videos</code>(<strong><code>vid_paths</code></strong>)</p>
</blockquote>
<p>Chunks videos into different scenes based on their content for later processing.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunk_videos</span><span class="p">(</span><span class="n">fixed_paths</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>



  0%|          | 0/1027 [00:00&lt;?, ?frames/s]



  1%|          | 7/1027 [00:00&lt;00:15, 65.97frames/s]



  2%|▏         | 17/1027 [00:00&lt;00:13, 72.33frames/s]



  3%|▎         | 27/1027 [00:00&lt;00:12, 78.51frames/s]



  4%|▎         | 37/1027 [00:00&lt;00:11, 83.65frames/s]



  5%|▍         | 47/1027 [00:00&lt;00:11, 87.14frames/s]



  6%|▌         | 57/1027 [00:00&lt;00:10, 88.49frames/s]



  7%|▋         | 67/1027 [00:00&lt;00:10, 90.05frames/s]



  7%|▋         | 77/1027 [00:00&lt;00:10, 91.49frames/s]



  8%|▊         | 87/1027 [00:00&lt;00:10, 93.22frames/s]



  9%|▉         | 97/1027 [00:01&lt;00:10, 92.98frames/s]



 10%|█         | 107/1027 [00:01&lt;00:09, 93.95frames/s]



 11%|█▏        | 117/1027 [00:01&lt;00:09, 94.91frames/s]



 12%|█▏        | 127/1027 [00:01&lt;00:09, 93.82frames/s]



 13%|█▎        | 137/1027 [00:01&lt;00:09, 94.19frames/s]



 14%|█▍        | 147/1027 [00:01&lt;00:09, 95.56frames/s]



 15%|█▌        | 157/1027 [00:01&lt;00:09, 96.29frames/s]



 16%|█▋        | 167/1027 [00:01&lt;00:08, 97.14frames/s]



 17%|█▋        | 177/1027 [00:01&lt;00:08, 97.77frames/s]



 18%|█▊        | 187/1027 [00:01&lt;00:08, 93.85frames/s]



 19%|█▉        | 197/1027 [00:02&lt;00:09, 90.11frames/s]



 20%|██        | 207/1027 [00:02&lt;00:09, 90.90frames/s]



 21%|██        | 217/1027 [00:02&lt;00:08, 90.15frames/s]



 22%|██▏       | 227/1027 [00:02&lt;00:08, 91.66frames/s]



 23%|██▎       | 237/1027 [00:02&lt;00:08, 90.87frames/s]



 24%|██▍       | 247/1027 [00:02&lt;00:08, 92.61frames/s]



 25%|██▌       | 257/1027 [00:02&lt;00:08, 93.53frames/s]



 26%|██▌       | 267/1027 [00:02&lt;00:08, 93.79frames/s]



 27%|██▋       | 277/1027 [00:02&lt;00:08, 93.72frames/s]



 28%|██▊       | 287/1027 [00:03&lt;00:07, 93.93frames/s]



 29%|██▉       | 297/1027 [00:03&lt;00:07, 95.67frames/s]



 30%|██▉       | 307/1027 [00:03&lt;00:07, 96.74frames/s]



 31%|███       | 317/1027 [00:03&lt;00:07, 97.46frames/s]



 32%|███▏      | 327/1027 [00:03&lt;00:07, 97.73frames/s]



 33%|███▎      | 337/1027 [00:03&lt;00:07, 96.35frames/s]



 34%|███▍      | 347/1027 [00:03&lt;00:07, 96.89frames/s]



 35%|███▍      | 357/1027 [00:03&lt;00:06, 96.18frames/s]



 36%|███▌      | 368/1027 [00:03&lt;00:06, 97.76frames/s]



 37%|███▋      | 378/1027 [00:04&lt;00:06, 97.50frames/s]



 38%|███▊      | 388/1027 [00:04&lt;00:06, 97.77frames/s]



 39%|███▉      | 398/1027 [00:04&lt;00:06, 97.58frames/s]



 40%|███▉      | 408/1027 [00:04&lt;00:06, 96.10frames/s]



 41%|████      | 418/1027 [00:04&lt;00:06, 96.44frames/s]



 42%|████▏     | 429/1027 [00:04&lt;00:06, 97.65frames/s]



 43%|████▎     | 439/1027 [00:04&lt;00:06, 97.80frames/s]



 44%|████▍     | 450/1027 [00:04&lt;00:05, 99.15frames/s]



 45%|████▍     | 460/1027 [00:04&lt;00:05, 97.82frames/s]



 46%|████▌     | 471/1027 [00:04&lt;00:05, 99.27frames/s]



 47%|████▋     | 481/1027 [00:05&lt;00:05, 99.27frames/s]



 48%|████▊     | 491/1027 [00:05&lt;00:05, 99.14frames/s]



 49%|████▉     | 501/1027 [00:05&lt;00:05, 98.93frames/s]



 50%|████▉     | 512/1027 [00:05&lt;00:05, 100.08frames/s]



 51%|█████     | 523/1027 [00:05&lt;00:04, 100.90frames/s]



 52%|█████▏    | 534/1027 [00:05&lt;00:04, 99.78frames/s] 



 53%|█████▎    | 545/1027 [00:05&lt;00:04, 100.17frames/s]



 54%|█████▍    | 556/1027 [00:05&lt;00:04, 100.95frames/s]



 55%|█████▌    | 567/1027 [00:05&lt;00:04, 101.60frames/s]



 56%|█████▋    | 578/1027 [00:06&lt;00:04, 101.40frames/s]



 57%|█████▋    | 589/1027 [00:06&lt;00:04, 101.84frames/s]



 58%|█████▊    | 600/1027 [00:06&lt;00:04, 102.17frames/s]



 59%|█████▉    | 611/1027 [00:06&lt;00:04, 101.64frames/s]



 61%|██████    | 622/1027 [00:06&lt;00:03, 102.22frames/s]



 62%|██████▏   | 633/1027 [00:06&lt;00:03, 102.52frames/s]



 63%|██████▎   | 644/1027 [00:06&lt;00:03, 99.10frames/s] 



 64%|██████▍   | 655/1027 [00:06&lt;00:03, 100.35frames/s]



 65%|██████▍   | 666/1027 [00:06&lt;00:03, 101.33frames/s]



 66%|██████▌   | 677/1027 [00:07&lt;00:03, 99.69frames/s] 



 67%|██████▋   | 688/1027 [00:07&lt;00:03, 100.44frames/s]



 68%|██████▊   | 699/1027 [00:07&lt;00:03, 100.15frames/s]



 69%|██████▉   | 710/1027 [00:07&lt;00:03, 99.47frames/s] 



 70%|███████   | 720/1027 [00:07&lt;00:03, 99.02frames/s]



 71%|███████   | 730/1027 [00:07&lt;00:03, 97.14frames/s]



 72%|███████▏  | 741/1027 [00:07&lt;00:02, 98.82frames/s]



 73%|███████▎  | 752/1027 [00:07&lt;00:02, 99.62frames/s]



 74%|███████▍  | 763/1027 [00:07&lt;00:02, 100.15frames/s]



 75%|███████▌  | 774/1027 [00:07&lt;00:02, 99.05frames/s] 



 76%|███████▋  | 784/1027 [00:08&lt;00:02, 97.86frames/s]



 77%|███████▋  | 794/1027 [00:08&lt;00:02, 96.93frames/s]



 78%|███████▊  | 804/1027 [00:08&lt;00:02, 97.12frames/s]



 79%|███████▉  | 814/1027 [00:08&lt;00:02, 97.42frames/s]



 80%|████████  | 824/1027 [00:08&lt;00:02, 96.79frames/s]



 81%|████████▏ | 835/1027 [00:08&lt;00:01, 98.61frames/s]



 82%|████████▏ | 846/1027 [00:08&lt;00:01, 99.29frames/s]



 83%|████████▎ | 857/1027 [00:08&lt;00:01, 100.33frames/s]



 85%|████████▍ | 868/1027 [00:08&lt;00:01, 101.06frames/s]



 86%|████████▌ | 879/1027 [00:09&lt;00:01, 101.78frames/s]



 87%|████████▋ | 890/1027 [00:09&lt;00:01, 101.88frames/s]



 88%|████████▊ | 901/1027 [00:09&lt;00:01, 102.34frames/s]



 89%|████████▉ | 912/1027 [00:09&lt;00:01, 102.44frames/s]



 90%|████████▉ | 923/1027 [00:09&lt;00:01, 101.99frames/s]



 91%|█████████ | 934/1027 [00:09&lt;00:00, 99.86frames/s] 



 92%|█████████▏| 945/1027 [00:09&lt;00:00, 100.97frames/s]



 93%|█████████▎| 956/1027 [00:09&lt;00:00, 101.26frames/s]



 94%|█████████▍| 967/1027 [00:09&lt;00:00, 101.77frames/s]



 95%|█████████▌| 978/1027 [00:10&lt;00:00, 101.98frames/s]



 96%|█████████▋| 989/1027 [00:10&lt;00:00, 102.35frames/s]



 97%|█████████▋| 1000/1027 [00:10&lt;00:00, 102.42frames/s]



 98%|█████████▊| 1011/1027 [00:10&lt;00:00, 102.72frames/s]



100%|██████████| 1027/1027 [00:10&lt;00:00, 97.97frames/s] 




  0%|          | 0/1027 [00:00&lt;?, ?frame/s]



 68%|██████▊   | 700/1027 [00:14&lt;00:06, 47.77frame/s]



 81%|████████  | 829/1027 [00:17&lt;00:04, 45.72frame/s]



100%|██████████| 1027/1027 [00:21&lt;00:00, 46.79frame/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
Writing 1026 frames to CSV...
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s2">&quot;decimate&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s1">&#39;output.mp4&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_rand_imgs" class="doc_header"><code>get_rand_imgs</code><a href="https://github.com/ncoop57/tango/tree/master/tango/prep.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_rand_imgs</code>(<strong><code>vid_path</code></strong>, <strong><code>max_msecs</code></strong>, <strong><code>n</code></strong>=<em><code>10</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imgs</span> <span class="o">=</span> <span class="n">get_rand_imgs</span><span class="p">(</span><span class="n">video_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">30_000</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="k">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_prep.ipynb.
Converted 01_features.ipynb.
Converted index.ipynb.
Converted lesson1-pets.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

